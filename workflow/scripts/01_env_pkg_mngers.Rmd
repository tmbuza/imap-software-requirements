# Environment & package management system
## Install conda
Conda is a package manager and can be obtained via Miniconda or Anaconda.

- For full installation guide click [here](https://conda.io/projects/conda/en/latest/user-guide/install/index.html).
- For documentation click [here](https://docs.conda.io/en/latest/).
- Miniconda: https://docs.conda.io/en/latest/miniconda.html
- Anaconda: https://docs.anaconda.com/
- Getting started with Conda: Click [here](https://docs.conda.io/projects/conda/en/latest/user-guide/getting-started.html).


## Install mamba
> Mamba is a CLI tool to manage conda environments

- Mamba can be obtained via Mambaforge.
- For full installation guide click [here](https://mamba.readthedocs.io/en/latest/installation.html).
- For documentation click [here](https://mamba.readthedocs.io/en/latest/user_guide/mamba.html).


## Demo installing Miniconda3 for Mac OS
```bash
curl -L  https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -o Miniconda3-latest-MacOSX-x86_64.sh
bash Miniconda3-latest-MacOSX-x86_64.sh
```
<!-- SnakeDeploy is a command line and interactive Python client to easily deploy snakemake pipelines from version control like GitHub -->


## Demo installing Mambaforge for Mac OS
```bash
curl -L https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-MacOSX-x86_64.sh -o Mambaforge-MacOSX-x86_64.sh
bash Mambaforge-MacOSX-x86_64.sh
```

## Setting up common channels
We will be using lots of bioinformatics and analysis tools. 

> - Note that most of the bioinformatics software are installed via `bioconda` channel. 
> - Most of analysis tools are installed via the `conda-forge` channel.
> - Some of the metagenomics analysis software will be installed via `biobakery` channel. 

```bash
conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
conda config --add channels biobakery
conda config --set auto_activate_base False
```

## Creating conda environment
Here we demonstrate:

- How to create an environment named `snakemake`. Replace snakemake with your preferred name!
- How to create an environment named `snakemake` with a specific python version.
- How to create an environment named `snakemake` with a specific python version and specific packages
- How to activate an environment.
- How to deactivate an environment.

## Using conda
```bash
conda create --name snakemake
conda create --name snakemake python==10
conda create --name snakemake python==10 pandas numpy seaborn
```
> Note: Each line of command performs independent task, so choose a method that suits you best.

## Using mamba
```bash
mamba create -c bioconda --name snakemake
mamba create --name snakemake python==10
mamba create --name snakemake python==10 pandas numpy seaborn
```

## Activating and deactivating environment
```bash
conda activate snakemake

conda deactivate snakemake
```

> - After setting up the channels and creating an environment we can install more software. 
> - For installation we will be using `Mamba package manager` instead of `Conda package manager` because it is much faster. 

## Updating conda
```bash
conda update conda
conda -V

mamba update conda
mamba -V
```

## Checking conda version
```bash
conda -V

mamba -V
```

<br>


## Reproducing existing environment
Requires an environment `spec` file or a `yaml` file

### Creating an env spec file
```bash
conda list --explicit > env_spec_file.txt
```

### Creating a new environment from a spec file
```bash
conda create --name new_env --file env_spec_file.txt
```

### Installing packages from a spec file
```bash
conda install --name existing_env --file env_spec_file.txt
```

### Creating new env from a YAML file
- First create the YAML or YML file:
  - `environment.yml`
  - `environment.yaml`
  - Here we save the environment.yaml file in `workflow/envs` folder and is configured to contain the following:
```
name: imap
channels:
  - conda-forge
  - bioconda
  - defaults
  - r
dependencies:
  - snakemake =7.19.1
  - snakemake-minimal =7.19.1
  - snakemake-wrapper-utils =0.5.0
  - snakedeploy =0.8.6
  - python =3.11.0
  - r-base =4.1.3
  - r-tidyverse =1.3.2 
  - r-bookdown =0.32
  - r-htmltools =0.5.4 
  - r-htmlwidgets =1.6.1
  - r-leaflet =2.1.1
  - r-leaflet.providers =1.9.0 
  - r-rmarkdown =2.20
  - r-schtools =0.4.0
  - graphviz =6.0.1
```

```bash
conda activate base
mamba env create --name imap --file workflow/envs/environment.yaml
```

## Checking available environments
If everything went smoothly, you should see the newly created environment, ready to be activated. Great!
```bash
mamba env list
```

```bash
conda activate imap
```

## Removing an environment
```bash
conda env list
```
<img src="images/conda_list.png">

```bash
conda deactivate

conda env remove --name imap

conda env list
```



